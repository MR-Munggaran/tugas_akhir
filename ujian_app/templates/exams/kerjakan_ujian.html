<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Akses Ujian</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    {% include '_navbar.html' %}
    <div class="container mt-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>{{ ujian.nama_ujian }}</h1>
            <div class="timer-container">
                <div class="timer bg-danger text-white p-2 rounded">
                    <span id="timer">00:00:00</span>
                </div>
            </div>
        </div>
        
        <form id="ujianForm" method="post">
            {% csrf_token %}
            {% for soal in soal_list %}
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">Soal {{ forloop.counter }}</h5>
                    <p class="card-text">{{ soal.pertanyaan }}</p>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="soal_{{ soal.id }}" id="soal_{{ soal.id }}_a" value="A" required>
                        <label class="form-check-label" for="soal_{{ soal.id }}_a">{{ soal.pilihan_a }}</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="soal_{{ soal.id }}" id="soal_{{ soal.id }}_b" value="B">
                        <label class="form-check-label" for="soal_{{ soal.id }}_b">{{ soal.pilihan_b }}</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="soal_{{ soal.id }}" id="soal_{{ soal.id }}_c" value="C">
                        <label class="form-check-label" for="soal_{{ soal.id }}_c">{{ soal.pilihan_c }}</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="soal_{{ soal.id }}" id="soal_{{ soal.id }}_d" value="D">
                        <label class="form-check-label" for="soal_{{ soal.id }}_d">{{ soal.pilihan_d }}</label>
                    </div>
                </div>
            </div>
            {% endfor %}
            <button type="submit" class="btn btn-primary">Submit Jawaban</button>
        </form>
    </div>
    
    <script>
    // Timer countdown
    const waktuHabis = new Date('{{ waktu_habis|escapejs }}');
    let timerInterval;
    
    function updateTimer() {
        const now = new Date();
        const diff = waktuHabis - now;
        
        if (diff <= 0) {
            clearInterval(timerInterval);
            document.getElementById('timer').textContent = "Waktu Habis!";
            document.getElementById('ujianForm').submit();
            return;
        }
        
        const hours = Math.floor(diff / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        
        document.getElementById('timer').textContent = 
            `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        // Ubah warna saat waktu hampir habis
        if (hours === 0 && minutes < 5) {
            document.querySelector('.timer').classList.add('bg-warning');
            document.querySelector('.timer').classList.remove('bg-danger');
        }
    }
    
    // Start timer
    timerInterval = setInterval(updateTimer, 1000);
    updateTimer(); // Initial call
    
    // Handle page refresh
    window.addEventListener('beforeunload', function(e) {
        if (document.getElementById('timer').textContent !== "Waktu Habis!") {
            e.preventDefault();
            e.returnValue = 'Anda sedang mengerjakan ujian. Yakin ingin meninggalkan halaman?';
        }
    });
    </script>
    
    <style>
    .timer {
        font-size: 1.2rem;
        font-weight: bold;
        min-width: 120px;
        text-align: center;
    }
    </style>
    </div>
  </body>
</html>
